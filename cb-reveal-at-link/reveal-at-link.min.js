engine.extend("2.0.0",()=>{engine.template.inserts.add({match:/^reveal\s+at\s+link/i,render(a,b){return window.addEventListener("click",a=>{let b=a.target,c=b.dataset.cbRevealatText,d=b.dataset.cbRevealatTarget;if(b.dataset.cbRevealatPassage&&(c=passageNamed(b.dataset.cbRevealatPassage).source),c&&d){const a=document.createElement("div");a.innerHTML=engine.template.render(c).trim();const e=a.children.length,f=document.querySelector(d);if(0<e&&f){const c=document.createElement("span");if(c.innerHTML=a.firstChild.innerHTML,f.parentNode.insertBefore(c,f),a.removeChild(a.firstChild),1<e){const c=a.lastChild;for(;a.lastChild;)f.parentNode.insertBefore(a.lastChild,f.nextSibling);for(;b.nextSibling;)c.insertBefore(b.nextSibling,null)}}b.parentNode.removeChild(b)}}),b.text?`<passage-link class="link"
                       data-cb-revealat-text="${b.text}"
                       data-cb-revealat-target="${b.target}">${a}</passage-link>`:b.passage?`<passage-link class="link"
                       data-cb-revealat-passage="${b.passage}"
                       data-cb-revealat-target="${b.target}">${a}</passage-link>`:void 0}})});